services:
  viupper:
    build: .
    container_name: viupper
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
      - MINIO_ENDPOINT=${MINIO_ENDPOINT}
      - MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY}
      - MINIO_SECRET_KEY=${MINIO_SECRET_KEY}
      - MINIO_SECURE=${MINIO_SECURE}
      - SOURCE_BUCKET=${SOURCE_BUCKET}
      - TARGET_BUCKET=${TARGET_BUCKET}
      - TEMP_DIR=/app/temp
      - LOG_LEVEL=INFO
    volumes:
      - ./temp:/app/temp
    labels:
      - traefik.enable=true
      - traefik.http.routers.viupper.rule=Host(`${SUBDOMAIN}.${DOMAIN_NAME}`)
      - traefik.http.routers.viupper.entrypoints=websecure
      - traefik.http.routers.viupper.tls.certresolver=myresolver
      - traefik.http.routers.viupper.middlewares=viupper-headers@docker
      - traefik.http.middlewares.viupper-headers.headers.SSLRedirect=true
      - traefik.http.middlewares.viupper-headers.headers.STSSeconds=315360000
      - traefik.http.middlewares.viupper-headers.headers.browserXSSFilter=true
      - traefik.http.middlewares.viupper-headers.headers.contentTypeNosniff=true
      - traefik.http.middlewares.viupper-headers.headers.forceSTSHeader=true
      - traefik.http.middlewares.viupper-headers.headers.SSLHost=${DOMAIN_NAME}
      - traefik.http.middlewares.viupper-headers.headers.STSIncludeSubdomains=true
      - traefik.http.middlewares.viupper-headers.headers.STSPreload=true
    networks:
      - web

networks:
  web:
    external: true